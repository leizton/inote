# 简介
通过zk构建分布式系统
zk从文件系统api获得灵感, 提供一套简单的接口帮助应用实现多机器间的协作, 如选主、崩溃检测、管理组内成员关系、管理元数据
选主的过程其实是获取锁的过程
同一台机器上的多个进程和跨机器的多个进程区别不大
zk不适合存储大量应用数据
分布式进程的通信方式: 直接通过网络收发msg, 或读写共享存储
多主情况下, 备份主节点接管主主节点时, 不是简单地开始处理请求, 还需要恢复到旧主主节点的状态
当某些从节点无法与主主节点通信, 如出现错误的网络分区, 结果部分从节点与其他主节点建立主从关系, 这种情况称脑裂: 系统中出现多个独立工作的集群
CAP: 一致性(Consistency)、可用性(Avail-ability)、分区容错性(Partition-Tolerance)

# 了解zk
## znode
zk操作和维护一个小型节点集, 节点称znode, 组织结构类似文件系统的层级树状结构
znode可能含有或不含有数据, 数据存储形式是byte数组
临时节点在会话失效, 或client主动删除时被删除. client先与server建立会话, 再发出请求
有序节点, 一种创建具有唯一名称的znode的方式
四种节点: 持久(persistent), 临时(ephemeral), 持久有序(sequential), 临时有序
每个znode都有一个版本号, 每次数据变化都原子地改变版本号
## watch
client向zk注册需要接收通知的znode, 并设置监视点, 收到通知后如果还想继续接收通知, 应再次设置监视点
client接收通知避免了client轮询zk上的节点信息